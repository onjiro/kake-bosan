<%= render :file => 'layouts/_entry_form.html.erb' %>

<h3>▼履歴</h3>
<div class="row" style="min-height: 320px;">
  <section class="history col-sm-12">
    <table class="table" ng-show="transactions.$resolved" ng-cloak>
      <thead>
        <tr>
          <th></th>
          <th>日時</th>
          <th>借方科目</th>
          <th>借方金額</th>
          <th>貸方科目</th>
          <th>貸方金額</th>
          <th></th>
        </tr>
      </thead>
      <tbody
         ng-repeat="transaction in transactions | orderBy:'date':true"
         ng-click="transaction.showDetails = !transaction.showDetails"
         ng-init="transaction.displayFormat = transaction.toDisplayFormat()">
        <!-- 概要 -->
        <tr class="history-row history-row-outline"
            ng-hide="transaction.showDetails">
          <td class="row-expands">
            <span ng-show="transaction.displayFormat.rows.length > 1">
              <i class="caret caret-right"></i>
            </span>
          </td>
          <td>{{ transaction.date | date: 'yyyy-MM-dd' }}</td>
          <td>{{transaction.getSummaryAccount()}}</td>
          <td class="amount" style="text-align: right;">&yen;{{transaction.getAmount() | number: 0}}</td>
          <td>{{transaction.getSummaryAccount()}}</td>
          <td class="amount" style="text-align: right;">&yen;{{transaction.getAmount() | number: 0}}</td>
          <td class="transaction-controls">
            <button type="button" class="delete-row pull-right"
                    ng-click="$event.stopPropagation(); remove(transaction)">x</button>
          </td>
        </tr>

        <!-- 詳細 -->
        <tr class="history-row history-row-details"
            ng-repeat="row in transaction.displayFormat.rows"
            ng-show="transaction.showDetails">
          <td>
            <span ng-show="$index === 0">
              <i class="caret"></i></td>
          </span>
          <td>{{ $index === 0 ? transaction.date: '' | date: 'yyyy-MM-dd'}}</td>
          <td>{{ row.debit ? row.debit.item_id: '' | itemName}}</td>
          <td class="amount" style="text-align: right;">{{ row.debit ? '&yen;': '' }}{{ row.debit ? row.debit.amount: '' | number: 0 }}</td>
          <td>{{ row.credit ? row.credit.item_id: '' | itemName }}</td>
          <td class="amount" style="text-align: right;">{{ row.credit ? '&yen;': '' }}{{ row.credit ? row.credit.amount: '' | number: 0 }}</td>
          <td>
            <span ng-show="$index === 0">
              <button type="button" class="delete-row pull-right"
                      ng-click="$event.stopPropagation(); remove(transaction)">x</button>
            </span>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="loading well" ng-hide="transactions.$resolved">ロード中...</div>
  </section>

</div><!--/row-->
