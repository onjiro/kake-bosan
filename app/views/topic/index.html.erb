<%= render :file => 'layouts/_entry_form.html.erb' %>

<h3>▼履歴</h3>
<div class="row" style="min-height: 320px;">
  <section class="history">
    <table class="table table-striped table-bordered" ng-show="transactions.$resolved" ng-cloak>
      <thead>
        <tr>
          <th>日時</th>
          <th>費用 or 資産</th>
          <th>金額</th>
        </tr>
      </thead>
      <tbody>
        <!-- 履歴を表示します -->
        <tr ng-repeat="transaction in transactions | orderBy:'date':true"
            ng-click="transaction.showDetails = !transaction.showDetails"
            ng-init="transaction.displayFormat = transaction.toDisplayFormat()">
          <td ng-hide="transaction.showDetails">{{transaction.date | date: 'yyyy-MM-dd'}}</td>
          <td ng-hide="transaction.showDetails">{{transaction.getSummaryAccount()}}</td>
          <td ng-hide="transaction.showDetails" style="text-align: right">&yen;{{transaction.getAmount() | number: 0}}</td>

          <td ng-show="transaction.showDetails" colspan="3">
            <table class="table table-bordered">
              <tbody>
                <tr ng-repeat="row in transaction.displayFormat.rows">
                  <td>{{ $index === 0 ? transaction.date: '' | date: 'yyyy-MM-dd'}}</td>
                  <td>{{ row.debit ? row.debit.item_id: '' | itemName}}</td>
                  <td>{{ row.debit ? '&yen;': '' }}{{ row.debit ? row.debit.amount: '' }}</td>
                  <td>{{ row.credit ? row.credit.item_id: '' | itemName }}</td>
                  <td>{{ row.credit ? '&yen;': '' }}{{ row.credit ? row.credit.amount: '' }}</td>
                  <td>
                    <button type="button" class="delete-row pull-right"
                            ng-click="$event.stopPropagation(); remove(transaction)">x</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
      </tbody>
    </table>
    <div class="loading well" ng-hide="transactions.$resolved">ロード中...</div>
  </section>
</div><!--/row-->
